<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ksrcb.api.biz.mapper.UserCenterMapper">
   <!-- 用户列表查询-->
    <select id="queryUserList" parameterType="com.ksrcb.api.biz.model.system.User" resultType="com.ksrcb.api.biz.model.system.User">
        SELECT
            user_id,
            username,
            user_type,
            state,
            mobile,
            email,
            create_time,
            update_time,
            name,
            asso_role,
            department,
            belong_system,
            systemMgmr
        FROM
        user
        <where>
            <if test="username!=null and username!=''">
                username like concat('%',#{username}, '%')
            </if>
            <if test="department!=null and department!=''">
                and department like concat('%',#{department}, '%')
            </if>
            <if test="belong_system!=null and belong_system!=''">
                and belong_system like concat('%',#{belong_system}, '%')
            </if>
            <if test="user_type!=null and user_type!=''">
                and user_type like concat('%',#{user_type}, '%')
            </if>
            <if test="user_type!=null and user_type!=''">
                and user_type like concat('%',#{user_type}, '%')
            </if>
            and state = 'A'
        </where>
    </select>

    <!--查询用户名是否重复-->
    <select id="qryRepeatUser" resultType="Integer">
        select count(*) from user where username = #{username}
    </select>

    <!--分配角色权限-->
    <insert id="addUserRole" parameterType="com.ksrcb.api.biz.model.system.UserRole">
        insert into user_role
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="user_id != null">
                user_id,
            </if>
            <if test="role_id != null">
                role_id,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="user_id != null">
                #{user_id},
            </if>
            <if test="user_id != null">
                #{role_id},
            </if>
        </trim>
    </insert>

    <!--新增用户-->
    <insert id="addUserInfo" parameterType="com.ksrcb.api.biz.model.system.User">
        insert into user
        <trim prefix="(" suffix=")" suffixOverrides=",">
        <if test="user_id != null">
            user_id,
        </if>
        <if test="username != null">
            username,
        </if>
        <if test="password != null">
            password,
        </if>
        <if test="salt != null">
            salt,
        </if>
        <if test="user_type != null">
            user_type,
        </if>
        <if test="state != null">
            state,
        </if>
        <if test="mobile != null">
            mobile,
        </if>
        <if test="email != null">
            email,
        </if>
        <if test="create_time != null">
            create_time,
        </if>
        <if test="update_time != null">
            update_time,
        </if>
        <if test="asso_role != null">
            asso_role,
        </if>
        <if test="name != null">
            name,
        </if>
        <if test="department != null">
            department,
        </if>
        <if test="systemMgmr != null">
            systemMgmr,
        </if>
        <if test="belong_system != null">
            belong_system,
        </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="user_id != null">
                #{user_id},
            </if>
            <if test="username != null">
                #{username},
            </if>
            <if test="password != null">
                #{password},
            </if>
            <if test="salt != null">
                #{salt},
            </if>
            <if test="user_type != null">
                #{user_type},
            </if>
            <if test="state != null">
                #{state},
            </if>
            <if test="mobile != null">
                #{mobile},
            </if>
            <if test="email != null">
                #{email},
            </if>
            <if test="create_time != null">
                #{create_time},
            </if>
            <if test="update_time != null">
                #{update_time},
            </if>
            <if test="asso_role != null">
                #{asso_role},
            </if>
            <if test="name != null">
                #{name},
            </if>
            <if test="department != null">
                #{department},
            </if>
            <if test="systemMgmr != null">
                #{systemMgmr},
            </if>
            <if test="belong_system != null">
                #{belong_system},
            </if>
        </trim>
    </insert>

    <!--查询角色信息-->
    <select id="queryRoleList" parameterType="com.ksrcb.api.biz.model.system.Role" resultType="com.ksrcb.api.biz.model.system.Role">
    SELECT
        role_id,
        description,
        role_type,
        remark
    FROM
	    role
        <where>
            <if test="role_id!=null and role_id!=''">
                role_id like concat('%',#{role_id}, '%')
            </if>
            <if test="description!=null and description!=''">
                and description like concat('%',#{description}, '%')
            </if>
            <if test="role_type!=null and role_type!=''">
                and role_type like concat('%',#{role_type}, '%')
            </if>
                and state = 'A'
        </where>
    </select>

    <!--修改用户基本信息-->
    <update id="updateUserInfo" parameterType="com.ksrcb.api.biz.model.system.User">
        UPDATE user
        <set>
            <if test="username !=null and username!= '' ">
                username = #{username},
            </if>
            <if test="password !=null and password!= '' ">
                password = #{password},
            </if>
            <if test="salt !=null and salt!= '' ">
                salt = #{salt},
            </if>
            <if test="user_type !=null and user_type!= '' ">
                user_type = #{user_type},
            </if>
            <if test="state !=null and state!= '' ">
                state = #{state},
            </if>
            <if test="mobile !=null and mobile!= '' ">
                mobile = #{mobile},
            </if>
            <if test="update_time !=null and update_time!= '' ">
                update_time = #{update_time},
            </if>

            <if test="asso_role !=null and asso_role!= '' ">
                asso_role = #{asso_role},
            </if>
            <if test="update_time !=null and update_time!= '' ">
                update_time = #{update_time},
            </if>
            <if test="name !=null and name!= '' ">
                name = #{name},
            </if>
            <if test="department !=null and department!= '' ">
                department = #{department},
            </if>
            <if test="systemMgmr !=null and systemMgmr!= '' ">
                systemMgmr = #{systemMgmr},
            </if>
            <if test="belong_system !=null and belong_system!= '' ">
                belong_system = #{belong_system},
            </if>
        </set>
        WHERE
             user_id  = #{user_id};
    </update>

    <!--删除用户-->
    <update id="delUser" parameterType="com.ksrcb.api.biz.model.system.User">
        UPDATE user
        <set>
            <if test="user_id !=null and user_id!= '' ">
                user_id = #{user_id},
            </if>
            <if test="username !=null and username!= '' ">
                username = #{username},
            </if>
            <if test="state !=null and state!= '' ">
                state = #{state},
            </if>
        </set>
        WHERE
        user_id  = #{user_id};
    </update>

    <!--修改角色基本信息-->
    <update id="updateRoleInfo" parameterType="com.ksrcb.api.biz.model.system.Role">
        UPDATE role
        <set>
            <if test="description !=null and description!= '' ">
                description = #{description},
            </if>
            <if test="remark !=null and remark!= '' ">
                remark = #{remark},
            </if>
        </set>
        WHERE
            role_id  = #{role_id};
    </update>

    <!--删除角色信息-->
    <update id="delRole" parameterType="com.ksrcb.api.biz.model.system.Role">
        UPDATE role
        <set>
            <if test="description !=null and description!= '' ">
                description = #{description},
            </if>
            <if test="state !=null and state!= '' ">
                state = #{state},
            </if>
        </set>
        WHERE
        role_id  = #{role_id};
    </update>

    <!--查询机构-->
    <select id="queryBranchList" parameterType="com.ksrcb.api.biz.model.system.Branch" resultType="com.ksrcb.api.biz.model.system.Branch">
        SELECT
            branch_no,
            branch_name,
            group_no,
            group_name
        FROM
	        branch
    </select>

    <select id="qryRepeatBranch" resultType="Integer">
        select count(*) from branch where branch_no = #{branch_no}
    </select>

    <!--新增机构-->
    <insert id="addBranchInfo" parameterType="com.ksrcb.api.biz.model.system.Branch">
        insert into branch
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="branch_no != null">
                branch_no,
            </if>
            <if test="branch_name != null">
                branch_name,
            </if>
            <if test="group_no != null">
                group_no,
            </if>
            <if test="group_name != null">
                group_name,
            </if>
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="branch_no != null">
                #{branch_no},
            </if>
            <if test="branch_name != null">
                #{branch_name},
            </if>
            <if test="group_no != null">
                #{group_no},
            </if>
            <if test="group_name != null">
                #{group_name},
            </if>
        </trim>
    </insert>

    <!--修改机构基本信息-->
    <update id="updateBranchInfo" parameterType="com.ksrcb.api.biz.model.system.Branch">
        UPDATE branch
        <set>
            <if test="group_no !=null and group_no!= '' ">
                group_no = #{group_no},
            </if>
            <if test="group_name !=null and group_name!= '' ">
                group_name = #{group_name},
            </if>
        </set>
        WHERE
        branch_no  = #{branch_no};
    </update>

</mapper>